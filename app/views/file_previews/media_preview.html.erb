<%
# Copyright (C) 2014 - present Instructure, Inc.
#
# This file is part of Canvas.
#
# Canvas is free software: you can redistribute it and/or modify it under
# the terms of the GNU Affero General Public License as published by the Free
# Software Foundation, version 3 of the License.
#
# Canvas is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
# A PARTICULAR PURPOSE. See the GNU Affero General Public License for more
# details.
#
# You should have received a copy of the GNU Affero General Public License along
# with this program. If not, see <http://www.gnu.org/licenses/>.
%>

<% content_for :head, include_common_stylesheets %>
<%= render :partial => "layouts/head" %>
<%# js_env :NEW_FILES_PREVIEW => 1 %>
<%# js_bundle :file_preview %>
<body style="margin:0; padding: 0; background: transparent;">
  <!--
  <div id="content" class="file_preview_container">
    <div id="media_preview" <%= media_preview_attributes(@file) %>></div>
  </div>
  -->
  <div id="content" class="file_preview_container">
    <video id="video" style="width: 100%; height: 100%" autoplay loop muted controls />
  </div>

  <%= render :partial => 'layouts/foot', :locals => { :include_common_bundle => true } %>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
      window.onload = function () {
        var m3u8Url = '<%= @file.playback_url %>';
        var video = document.getElementById('video');
        if (Hls.isSupported()) {
          var hls = new Hls();
          hls.loadSource(m3u8Url);
          hls.attachMedia(video);
          hls.on(Hls.Event.MANIFEST_PARSED, function () {
            video.play();
          });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = m3u8Url;
          video.addEventListener('loadedmetadata',function() {
            video.play();
          });
        }
      };
  </script>
</body>
